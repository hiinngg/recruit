<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>轮播图编辑（建议640px * 300px）</title>
<link rel="stylesheet" type="text/css" href="/admin/layui/css/layui.css" />
</head>
<style>
.label_img{
	object-fit:cover;
	width:100%;
	height:100%;
}
.hide{
	display:none;
}
</style>

<body style="overflow:scroll;">

	<form class="layui-form"  action=""  style="width:70%;">
<!--  	<button type="button"   class="layui-btn " id="cover1">
	<input type="text"  hidden name="label_img" value="{$data.label_img??''}" />
	<i class="layui-icon">&#xe67c;</i>上传
	</button> -->

{volist name="data.path" id="vo"}
<div class="imgupload" style="margin:15px 0 0 110px;width:640px;height:300px;text-align:center;border:1px solid #ccc; line-height:300px;position:relative;">
		<span class="layui-icon">&#xe654;</span>
		<button class="layui-btn layui-icon del hide" style="position:absolute;right:0;top:0;">&#xe640;</button>
		{neq name="vo" value="$i"}
		<button class="layui-btn layui-icon del" style="position:absolute;right:0;top:0;">&#xe640;</button>
		<img  src="{$vo}" width='640px' height='300px' class="cover" style="position:absolute;top:0;left:0;z-index:-1;">
		{/neq}
				   
</div>	
{/volist}
	
  </div>

  <div class="layui-form-item">
    <div class="layui-input-block" style="margin-top:30px;">
      <button class="layui-btn" lay-submit lay-filter="formDemo">保存</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>

  </form>
    
    <script type="text/javascript" src="/admin/ueditor/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="/admin/ueditor/ueditor.all.js"></script>
    <!-- 实例化编辑器 -->
	<script src="/admin/js/jquery-3.2.1.min.js"></script>
	<script src="/admin/layui/layui.js"></script>
	<script>
	layui.use(['form','upload','layer'], function(){
		  var form   = layui.form;
		  var upload = layui.upload;
		  var layer  = layui.layer;


		  upload.render({
			   elem: '.imgupload'
			  ,url: "{:url('imgUpload')}",
			  field:"image"
			  ,done: function(res, index, upload){			  
			    if(res.code == 0){	
			         $(this.item).children("button").removeClass("hide");
			     if( $(this.item).children("img").length>0){
			    	 $(this.item).children("img").attr("src",res.src.replace(/\\/g,'/'))
			     }else{
			    	 $(this.item).append('<img  src="'+res.src.replace(/\\/g,'/')+'" width="640px" height="300px" class="cover" style="position:absolute;top:0;left:0;z-index:-1;">')
			    	 	
			     }
			    }			    
			    //获取当前触发上传的元素，一般用于 elem 绑定 class 的情况，注意：此乃 layui 2.1.0 新增
		 
			    //文件保存失败
			    //do something
			  }
			}); 
		  
		   $(".del").on("click",function(e){
		    	e.stopPropagation();
		        $(this).parent().children("img").remove();
		        $(this).addClass("hide")
		        return false;
		    })
		  
		  //监听提交
		  form.on('submit(formDemo)', function(data){
			 	var images=[];
            	$(".imgupload").each(function(){
            	if($(this).children("img").length>0){
            		images.push($(this).children("img").attr("src"))	
            	}	
            		
            	})

	 		   if (images === undefined ||images.length == 0) {
	            layer.msg("请上传轮播图",{icon:5,shift:6})
	            return false;
	        }
            	
            	  var url="{:url('edit')}";
                  var data={images:images}
                  {present name="data"}
                  data['carid']="{$data.carid}"
                  {/present}
                      $.ajax({
                          url:url,
                          data:data,
                          type:"POST",
                          beforeSend:function(){
                              layer.load(2, {shade: false});
                          },
                          success:function(data){
                              layer.closeAll()
                              if(data==1){
                                  layer.msg("保存成功",{ time: 700 },function(){
                                      history.go(0)
                                  })
                              }
                          }
                      })
	    
		    return false;
		  });
		  		  
     
		  
		  
		});
	</script>

</body>
</html>