{extend name="indexlayout" /}
{block name="nav-user"}weui-bar__item_on{/block}
{block name="css"}

.weui-navbar:after,.weui-navbar__item:after,.hidden{
display:none; 
}
.weui-navbar__item.weui-bar__item--on{
color:#1881ec;
background:#ffffff;
}
.wrap:after{
    position: absolute;
    top: 0;
    left: 0;
    content: "";
    background-color: #ffffff;;
    opacity: 0.5;
    z-index: 1;
    width: 100%;
    height: 100%;
}

.cl-active{
color:#1881EC;
}
{/block}
{block name="content"}
<div class="wrap" style="position:relative;width:100%;height:226px; background-image: url(/static/images/user.png);background-size:cover;">
    <span class="fa fa-list menu" style="position:absolute;top:15px;right:30px;z-index:10;"></span>
  <img src="{:empty($data.avastar)? '/static/images/avastar.png'  :$data.avastar}"  style="position:absolute;z-index:10;top:50%;left:50%;margin-top:-73px;margin-left:-73px; width:146px;height:146px;border-radius:50%;border:5px solid #717171;"/>
</div>
<div class="weui-tab">
  <div class="weui-navbar" style="border-bottom:1px solid #eee;">
    <a class="weui-navbar__item weui-bar__item--on" href="#tab1">
      我的简历
    </a>
    <a class="loadjobitem  weui-navbar__item"  data-url="{:url('user/jobuser')}"  href="#tab2">
      我的申请
    </a>
        <a class="loadcourseitem weui-navbar__item"  data-url="{:url('user/courseuser')}" href="#tab3">
      我的课程
    </a>
 
  </div>
  <div class="weui-tab__bd">
    <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">


        <!-- 评测 -->
        <div  style="display:flex;justify-content:flex-end;align-items:center;margin-right:10px;margin-top:10px;">
            <a href="javascript:;"  data-target="#eval"  style="margin:0;" class=" open-popup weui-btn weui-btn_mini  weui-btn_plain-default">综合能力报告</a>
        </div>





       <div style="padding:0 15px;">
        {present name="none"}
            <p class="text-center sever">你还没有填写简历,<a  href="{:url('editprofile')}"  >马上去填写</a></p>
            {else/}   
            
          <div class="weui-panel weui-panel_access">
       <!--  <div class="weui-panel__hd">文字组合列表</div> -->
        <div class="weui-cells">
		  <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>姓名</p>
		    </div>
		    <div class="weui-cell__ft">{$data.truename}</div>
		  </div>
		   <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>性别</p>
		    </div>
		    <div class="weui-cell__ft">{$data.sex==0?'男':"女"}</div>
		  </div>
		  <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>出生日期</p>
		    </div>
		    <div class="weui-cell__ft">{$data.birthdate}</div>
		 </div>
		  <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>目标职位</p>
		    </div>
		    <div class="weui-cell__ft">{$data.position}</div>
		 </div>
		   <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>毕业院校</p>
		    </div>
		    <div class="weui-cell__ft">{$data.graduated}</div>
		 </div>
		   <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <p>学历</p>
		    </div>
		    <div class="weui-cell__ft">{$data.education}</div>
		 </div>
		</div><!-- cells -->
		
		 <div class="weui-panel__bd">
          <div class="weui-media-box weui-media-box_text">
            <h4 class="weui-media-box__title">自我评价</h4>
            <p class="weui-media-box__desc">{$data.selfevaluation}</p>
          </div>
          <div class="weui-media-box weui-media-box_text">
            <h4 class="weui-media-box__title">工作经历</h4>
            <p class="weui-media-box__desc">{$data.experience}</p>
          </div>
        </div>
      </div><!-- panel -->
      
        <a href="{:url('editprofile')}"   class=" weui-btn weui-btn_plain-default">修改简历</a>     
      
	  
	      
        {/present}
       </div>
 
     

    </div>
    <div id="tab2" class="weui-tab__bd-item"   style="background:#eee;position:relative;overflow: hidden;">


        <div class="item row-center text-center"  style="width:100%;height:35px;background:#ffffff;margin:15px 0;justify-content:space-around;">
            <p style="width:33%;">时间</p>
            <p style="width:33%;">申请职位</p>
            <p style="width:33%;">详情</p>
        </div>

        <div class="item my-items">
    
        </div>
      
        <div class="text-center  hidden">
      <a href="javascript:;"  data-currentpage="1"    style="margin-top:15px;"  class="weui-btn weui-btn_mini weui-btn_default loadmore">更多课程</a>
     </div><!-- loadmore -->

	<div class="weui-loadmore hidden loading">
	  <i class="weui-loading"></i>
	  <span class="weui-loadmore__tips">正在加载</span>
	</div><!-- loading -->
	
	<div class="weui-loadmore hidden  weui-loadmore_line  nomore">
	  <span class="weui-loadmore__tips" style="background:#eee;">暂无更多数据</span>
	</div><!-- no more -->
      
      
    </div><!-- 我的申请 -->
    
       <div id="tab3" class="weui-tab__bd-item" style="background:#eee;position:relative;overflow: hidden;">

           <div class="item row-center text-center"  style="width:100%;height:35px;background:#ffffff;margin:15px 0;justify-content:space-around;">
               <p style="width:33%;">时间</p>
               <p style="width:33%;">课程名称</p>
               <p style="width:33%;">详情</p>
           </div>

           <div class="item my-items">
            
           </div>
           
           
     <div class="text-center  hidden">
      <a href="javascript:;"  data-currentpage="1"    style="margin-top:15px;"  class="weui-btn weui-btn_mini weui-btn_default loadmore">更多课程</a>
     </div><!-- loadmore -->

	<div class="weui-loadmore hidden loading">
	  <i class="weui-loading"></i>
	  <span class="weui-loadmore__tips">正在加载</span>
	</div><!-- loading -->
	
	<div class="weui-loadmore hidden  weui-loadmore_line  nomore">
	  <span class="weui-loadmore__tips" style="background:#eee;">暂无更多数据</span>
	</div><!-- no more -->
           
    </div><!-- 我的课程 -->
   
  </div>
</div>

<div id="eval" style="z-index:2000;bottom:45px;" class="weui-popup__container popup-bottom">
    <div class="weui-popup__overlay"></div>
    <div class="weui-popup__modal">
        <div class="toolbar"  style="position:static;">
            <div class="toolbar-inner">
                <a href="javascript:;" class="picker-button close-popup">关闭</a>
                <h1 class="title">综合能力报告</h1>
            </div>
        </div>
        <div class="modal-content" style="padding:15px;">
        {present name="eval"}
        {volist  name="eval" id="vo"}
         <p style="padding:15px 0;margin-bottom:15px;">我的报告：<span>{$vo.name}</span></p>
           <hr>
           <p>{:date("Y-m-d",strtotime($vo.createtime))}</p>
           <p style="padding:8px 0;"><strong>报告说明：</strong>{$vo.desc}</p>
           <p style="padding:8px 0;color:#1881EC;" class="download" id="{$vo.evalid}"><strong style="color:#3d4145;">查看报告：</strong>{$vo.name}</p>
        {/volist}
        {else/}
           <p style="padding:15px 0;">我的报告：<span>暂无</span></p>
            <hr>
            <p>亲，综合能力报告是参与我们“职造计划”才能获得哦</p>
            
            {if condition="$data.eval eq 1"}
             <p class="sever " style="text-align:right;">申请成功，职造师会联系亲哦</p>
            {else/}
             <p class="sever evalApply" style="text-align:right;">立即参与</p>
            {/if}
        {/present}
        </div>
    </div>
</div>


{/block}
{block name="script"}
$(function(){


//询问用户是否绑定账号
{if condition="session('?muser') neq null"}
login();
{else/}
{/if}




$(".evalApply").on("click",function(){
var that =this
$.ajax({
url:"{:url('evalapply')}",
beforeSend:function(){
$.showLoading();
},
success:function(){
$.hideLoading();
$(that).text("申请成功，职造师会联系亲哦")
}

})

})

$(".download").on("click",function(){

  var evalid=$(this).attr("id")
 location.href="/mobile/myfile/evalDownload?evalid="+evalid
 // window.open("/admin/user/evalDownload?evalid="+evalid)
})



//渲染数据
function viewcoursedata(obj,initdata,invoke){
	var html="";
	 for(key in initdata  ){  
	 ttDate = initdata[key]['createtime'];   
	 ttDate = ttDate.match(/\d{4}.\d{1,2}.\d{1,2}/mg).toString(); 
     ttDate = ttDate.replace(/[^0-9]/mg, '-');   
	    feedbackhtml="";   
	 if(initdata[key]['status']==1){
	  feedbackhtml='<p class="texts-hide">'+initdata[key]['feedback']+'</p>';

	 }
	html+=' <div class="item "  style="width:100%;height:auto;background:#ffffff;margin:15px 0;">'+
                '<div class="row-center text-center" style="width:100%;height:35px;justify-content:space-around;">'+
                    '<p style="width:33%;">'+ttDate+'</p>'+
                    '<p class="text-hide" style="width:33%;">'+initdata[key]['name']+'</p>'+
                    '<p class="status" style="width:33%;"><span class="fa fa-caret-down">&nbsp;</span>'+(initdata[key]['status']==1?"<span style='color:red;'>查看反馈</span>":"查看")+'</p>'+
               ' </div>'+
               ' <div  class="hidden" style="background:#eee;padding:13px;">'+
                    '<p class="texts-hide"><span>课程导师：'+initdata[key]['teacher']+'</span>&nbsp;<span>联系方式：'+initdata[key]['contact']+'</span></p>'+
                    '<div style="height:1px;width:80%;background: #CCCCCC;margin: 15px 0;"></div>'+
                   feedbackhtml+
                '</div>'+

            '</div>';
           
	 }
	 
	 if(invoke){
	  $(obj).html(html);
	 }else{
	    $(obj).append(html);
	 }

}
function viewjobdata(obj,initdata,invoke){
	var html="";
	 for(key in initdata  ){  
	 ttDate = initdata[key]['createtime'];   
	 ttDate = ttDate.match(/\d{4}.\d{1,2}.\d{1,2}/mg).toString(); 
     ttDate = ttDate.replace(/[^0-9]/mg, '-');   
	 
	   feedbackhtml="";   
	 if(initdata[key]['status']==1){
	  feedbackhtml='<p style="margin:0;margin-top:10px;">内容已被查看，反馈如下</p>'+
	               '<div style="height:1px;width:80%;background: #CCCCCC;margin: 15px 0;"></div>'+
	               '<p class="texts-hide">'+initdata[key]['feedback']+'</p>';
	 
	 
	 }else{
	 feedbackhtml='<p style="margin:0;margin-top:10px;">亲，你的简历已经提交，职造师在审核中</p>'+
	                          '<div style="height:1px;width:80%;background: #CCCCCC;margin: 15px 0;"></div>';
     
	 }
	 
	html+=' <div class="item "  style="width:100%;height:auto;background:#ffffff;margin:15px 0;">'+
                '<div class="row-center text-center" style="width:100%;height:35px;justify-content:space-around;">'+
                    '<p style="width:33%;">'+ttDate+'</p>'+
                    '<p class="text-hide" style="width:33%;">'+initdata[key]['name']+'</p>'+
                    '<p class="status" style="width:33%;"><span class="fa fa-caret-down">&nbsp;</span>'+(initdata[key]['status']==1?"<span style='color:red;'>查看反馈</span>":"查看")+'</p>'+
               ' </div>'+
               ' <div  class="hidden" style="background:#eee;padding:13px;">'+
                    feedbackhtml+
                '</div>'+

            '</div>';
           
	 }
	 
	 if(invoke){
	  $(obj).html(html);
	 }else{
	    $(obj).append(html);
	 }

}

$(".loadjobitem").on("click",function(){
var that=$(this);
var url=$(this).attr("data-url");
$.ajax({
url:url,
beforeSend:function(){
$(that.attr("href")).find(".nomore").addClass("hidden")
//$(that.attr("href")).find("a.loadmore").attr("data-currentpage",1)
$.showLoading();
},
success:function(data){
if(data.length == 0){
$(that.attr("href")).find(".nomore").removeClass("hidden")
return;
}
//if(data.length == 4){
//$(that.attr("href")).find(".loadmore").parent().removeClass("hidden");
//}
viewjobdata($(that.attr("href")).find(".my-items"),data,true)
},
complete:function(){
$.hideLoading();
}

})
})
$(".loadcourseitem").on("click",function(){
var that=$(this);
var url=$(this).attr("data-url");
$.ajax({
url:url,
beforeSend:function(){
$(that.attr("href")).find(".nomore").addClass("hidden")
//$(that.attr("href")).find("a.loadmore").attr("data-currentpage",1)
$.showLoading();
},
success:function(data){
if(data.length == 0){
$(that.attr("href")).find(".nomore").removeClass("hidden")
return;
}
//if(data.length == 4){
//$(that.attr("href")).find(".loadmore").parent().removeClass("hidden");
//}
viewcoursedata($(that.attr("href")).find(".my-items"),data,true)
},
complete:function(){
$.hideLoading();
}

})
})





	
	
$(".my-items").on("click",".status",function(){
console.log("")
    $(this).toggleClass("cl-active");
    $(this).parent().next().toggleClass("hidden");
})

//保存
	
  





})
{/block}


